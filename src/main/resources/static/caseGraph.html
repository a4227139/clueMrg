<!DOCTYPE html>
<html lang="en" style="height: 100%">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>涉诈案件全景图</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Add custom CSS here -->
    <link href="css/sb-admin.css" rel="stylesheet">
    <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
    <link type="text/css" rel="stylesheet" href="css/jsgrid.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/jsgrid-theme.min.css"/>
    <link type="text/css" rel="stylesheet" href="css/clue.css"/>
    <script type="text/javascript" src="js/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="js/jsgrid.min.js"></script>
    <script type="text/javascript" src="js/constant.js"></script>
    <!-- 引入DateTimePicker插件的js和css文件 -->
    <link href="css/jquery.datetimepicker.min.css" rel="stylesheet">
    <script src="js/jquery.datetimepicker.full.min.js"></script>
    <script type="text/javascript" src="js/echarts.min.js"></script>


</head>

<body style="height: 100%">

<div id="wrapper">

    <!-- Sidebar -->
    <!-- Sidebar -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="">电诈线索研判系统</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav side-nav">
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-caret-square-o-down"></i> 线索 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/clue/btClue.html"><i class="fa fa-table"></i> 部推线索（柳州）</a></li>
                        <li><a href="/clue/ttClue.html"><i class="fa fa-table"></i> 厅推线索（柳州）</a></li>
                        <li><a href="/clue/gang.html"><i class="fa fa-table"></i> GOIP团伙（柳州）</a></li>
                        <li><a href="/clue/qgBtClue.html"><i class="fa fa-bar-chart-o"></i> 部推线索（全国）</a></li>
                        <li><a href="/clue/qgDkClue.html"><i class="fa fa-bar-chart-o"></i> 断卡线索（全国）</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-caret-square-o-down"></i> 日研判相关 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/analyze/alarmReceipt.html"><i class="fa fa-bar-chart-o"></i> 电诈接处警信息</a></li>
                        <li><a href="/analyze/victim.html"><i class="fa fa-bar-chart-o"></i> 受害人信息</a></li>
                        <li><a href="/analyze/effect.html"><i class="fa fa-bar-chart-o"></i> 战果信息</a></li>
                        <li><a href="/analyze/case.html"><i class="fa fa-camera-retro"></i> 案件列表</a></li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-caret-square-o-down"></i> 手机号 <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/phone/callLog.html"><i class="fa fa-bar-chart-o"></i> 通话记录</a></li>
                        <li><a href="/phone/attribution.html"><i class="fa fa-bar-chart-o"></i> 号码归属地查询</a></li>
                        <li><a href="/phone/phoneImei.html"><i class="fa fa-edit"></i> 号码-机身列表</a></li>
                        <li><a href="/phone/bsLocation.html"><i class="fa fa-edit"></i> 基站列表</a></li>
                    </ul>
                </li>
                <li><a href="/relationGraph.html"><i class="fa fa-camera-retro"></i> 关系图</a></li>
                <li class="active"><a href="/caseGraph.html"><i class="fa fa-camera-retro"></i> 涉诈案件全景图</a></li>
                <li><a href="/requisition.html"><i class="fa fa-camera-retro"></i> 止付查询</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right navbar-user">
                <li class="dropdown user-dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-user"></i><span id="username"> Admin </span><b
                            class="caret"></b></a>
                    <ul class="dropdown-menu">
                        <li><a href="/logout"><i class="fa fa-power-off"></i> Log Out</a></li>
                    </ul>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </nav>

    <div id="page-wrapper">
        <!--<div class="row" style="overflow:scroll; width:100%;overflow-x: auto; ">-->
        <div>
            <span>
                <h3 style="display: inline;margin: 10px;"><label>时间：</label></h3>
                <input class="form-control" style="display:inline;width:230px;font-size:20px;height: 35px;margin: 10px;" type="text" id="datetimepicker1">
                <h3 style="display: inline;margin: 10px;"><label>到</label></h3>
                <input class="form-control" style="display:inline;width:230px;font-size:20px;height: 35px;margin: 10px;" type="text" id="datetimepicker2">
                <!--<h3 style="display: inline;margin: 10px;"><label>分县局：</label></h3>
                <span class="form-group">
                    <select class="form-control" id="type" style="display:inline;width:150px;font-size:20px;height: 35px;margin: 10px;">
                          <option value ="phone">城中分局</option>
                          <option value ="imei">IMEI</option>
                          <option value="imsi">IMSI</option>
                          <option value="clue">线索编号</option>
                    </select>
                </span>-->
                    <label class="upload-btn" style="display: block" id="search-btn">
                    <span class="btn-text">查询</span>

                    <span class="btn-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M8 17v-5H6l6-7 6 7h-2v5H8zm-2 2h8v2H6v-2z"></path>
                        </svg>
                    </span>
                </label>
            </span>
            <div id="content3" style="height: 400px"><div id="container3" style="height: 100%"></div></div>
            <br/>
            <div id="content" style="height: 400px"><div id="container" style="height: 100%"></div></div>
            <br/>
            <div id="content2" style="height: 400px"><div id="container2" style="height: 100%"></div></div>
            <br/>
            <div id="content4" style="height: 400px"><div id="container4" style="height: 100%"></div></div>
            <br/>
            <div id="content5" style="height: 400px"><div id="container5" style="height: 100%"></div></div>
            <br/>
            </div>
            </div>
        </div>

        <!--<div id="container" style="height: 100%"></div>-->


    <script type="text/javascript">
        $(document).ready(function() {
            $.ajax({
                url: ROOT_PATH +'/security/getCurrentUsername', // 后台控制器的URL
                type: 'GET',
                success: function(username) {
                    $('#username').text(" "+username+" "); // 在页面上显示用户名
                },
                error: function(xhr, status, error) {
                    console.error(error);
                    // 处理错误情况
                }
            });
        });
        // 监听下拉菜单按钮的点击事件
        $('.dropdown-toggle').on('click', function() {
            // 切换下拉菜单的显示状态
            $(this).siblings('.dropdown-menu').toggle();
        });
        $(document).ready(function() {
            //加载完就显示
            $('#search-btn').click();
        });

        $('#datetimepicker1').datetimepicker({
            format: 'Y-m-d', // 时间格式，可根据需要进行调整
            timepicker: false, // 是否显示时间选择器
            datepicker: true, // 是否显示日期选择器
            yearStart: 1900, // 年份的起始值
            yearEnd: 2100, // 年份的结束值
            todayButton: true, // 是否显示“今天”按钮
            lang: 'zh', // 显示语言，中文为'zh'
            step: 1 // 时间间隔，单位为分钟
        });

        $('#datetimepicker2').datetimepicker({
            format: 'Y-m-d', // 时间格式，可根据需要进行调整
            timepicker: false, // 是否显示时间选择器
            datepicker: true, // 是否显示日期选择器
            yearStart: 1900, // 年份的起始值
            yearEnd: 2100, // 年份的结束值
            todayButton: true, // 是否显示“今天”按钮
            lang: 'zh', // 显示语言，中文为'zh'
            step: 1 // 时间间隔，单位为分钟
        });

        var dom = document.getElementById('container');
        var myChart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        var dom2 = document.getElementById('container2');
        var myChart2 = echarts.init(dom2, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        var dom3 = document.getElementById('container3');
        var myChart3 = echarts.init(dom3, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        var dom4 = document.getElementById('container4');
        var myChart4 = echarts.init(dom4, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        var dom5 = document.getElementById('container5');
        var myChart5 = echarts.init(dom5, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });

        var app = {};

        var winWidth=document.documentElement.clientWidth;
        var winHeight=document.documentElement.clientHeight;
        document.getElementById("container").style.width=winWidth+"px";
        document.getElementById("container").style.height=winHeight+"px";
        console.log(winWidth+":"+winHeight)
        console.log($('#datetimepicker1'))



        var option;
        //var ROOT_PATH = 'http://127.0.0.1:8080'

        $('#search-btn').click(function() {
            var dateStart=$('#datetimepicker1').val();
            var dateEnd=$('#datetimepicker2').val();
            $.get(ROOT_PATH + "/case/getCaseIndex?dateStart="+dateStart+"&dateEnd="+dateEnd, function (data) {
                console.log(data);
                jurisdictionArray=[];
                countArray=[];
                solveCountArray=[];
                lossMoneyFormatArray=[];
                averageLossMoneyArray=[];
                for (var i = 1; i < data.length; i++) {
                    jurisdictionArray.push(data[i].jurisdiction);
                    countArray.push(data[i].count);
                    solveCountArray.push(data[i].solveCount);
                    lossMoneyFormatArray.push(data[i].lossMoneyFormat);
                    averageLossMoneyArray.push(data[i].averageLossMoneyFormat);
                }
                option = {
                    title: {
                        text: '立案/破案数'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        }
                    },
                    legend: {},
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '3%',
                        containLabel: true
                    },
                    yAxis: {
                        type: 'value',
                        boundaryGap: [0, 0.01]
                    },
                    xAxis: {
                        type: 'category',
                        data: jurisdictionArray
                    },
                    series: [
                        {
                            name: '立案',
                            type: 'bar',
                            label: {
                                show: true,
                                position: 'inside'
                            },
                            data: countArray
                        },
                        {
                            name: '破案',
                            type: 'bar',
                            label: {
                                show: true,
                                position: 'inside'
                            },
                            data: solveCountArray
                        }
                    ]
                };
                if (option && typeof option === 'object') {
                    console.log("myChart.setOption(option)")
                    myChart.setOption(option);
                }
                const colors = ['#EE6666','#EE9096'];
                option2 = {
                    color: colors,
                    title: {
                        text: '损失金额/案均损失金额'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    /*grid: {
                        right: '20%'
                    },*/
                    toolbox: {
                        feature: {
                            dataView: { show: true, readOnly: false },
                            restore: { show: true },
                            saveAsImage: { show: true }
                        }
                    },
                    legend: {
                        data: ['损失金额', '案均损失金额']
                    },
                    xAxis: [
                        {
                            type: 'category',
                            axisTick: {
                                alignWithLabel: true
                            },
                            // prettier-ignore
                            data: jurisdictionArray
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '损失金额',
                            position: 'left',
                            alignTicks: true,
                            axisLine: {
                                show: true,
                                lineStyle: {
                                    color: colors[0]
                                }
                            },
                            axisLabel: {
                                formatter: '{value} 万元'
                            }
                        },
                        {
                            type: 'value',
                            name: '案均损失金额',
                            position: 'right',
                            alignTicks: true,
                            axisLine: {
                                show: true,
                                lineStyle: {
                                    color: colors[1]
                                }
                            },
                            axisLabel: {
                                formatter: '{value} 万元'
                            }
                        }

                    ],
                    series: [
                        {
                            name: '损失金额',
                            type: 'bar',
                            label: {
                                show: true,
                                position: 'top'
                            },
                            data: lossMoneyFormatArray
                        },
                        {
                            name: '案均损失金额',
                            type: 'bar',
                            label: {
                                show: true,
                                position: 'top'
                            },
                            yAxisIndex: 1,
                            data: averageLossMoneyArray
                        }
                    ]
                };
                if (option2 && typeof option2 === 'object') {
                    console.log("myChart2.setOption(option2)")
                    myChart2.setOption(option2);
                }
            });

            $.get(ROOT_PATH + "/graph/getCaseLineIndex?dateStart="+dateStart+"&dateEnd="+dateEnd, function (data) {
                var caseIndexList=data.caseIndexList;
                var caseSolveIndexList=data.caseSolveIndexList;
                var alarmReceiptIndexList=data.alarmReceiptIndexList;
                //var case_data = [["2000-06-05", 116], ["2000-06-06", 129], ["2000-06-07", 135], ["2000-06-08", 86], ["2000-06-09", 73], ["2000-06-10", 85], ["2000-06-11", 73], ["2000-06-12", 68], ["2000-06-13", 92], ["2000-06-14", 130], ["2000-06-15", 245], ["2000-06-16", 139], ["2000-06-17", 115], ["2000-06-18", 111], ["2000-06-19", 309], ["2000-06-20", 206], ["2000-06-21", 137], ["2000-06-22", 128], ["2000-06-23", 85], ["2000-06-24", 94], ["2000-06-25", 71], ["2000-06-26", 106], ["2000-06-27", 84], ["2000-06-28", 93], ["2000-06-29", 85], ["2000-06-30", 73], ["2000-07-01", 83], ["2000-07-02", 125], ["2000-07-03", 107], ["2000-07-04", 82], ["2000-07-05", 44], ["2000-07-06", 72], ["2000-07-07", 106], ["2000-07-08", 107], ["2000-07-09", 66], ["2000-07-10", 91], ["2000-07-11", 92], ["2000-07-12", 113], ["2000-07-13", 107], ["2000-07-14", 131], ["2000-07-15", 111], ["2000-07-16", 64], ["2000-07-17", 69], ["2000-07-18", 88], ["2000-07-19", 77], ["2000-07-20", 83], ["2000-07-21", 111], ["2000-07-22", 57], ["2000-07-23", 55], ["2000-07-24", 60]];
                //var solve_data = [["2000-06-05", 23], ["2000-06-06", 23], ["2000-06-07", 42], ["2000-06-08", 86], ["2000-06-09", 73], ["2000-06-10", 85], ["2000-06-11", 73], ["2000-06-12", 54], ["2000-06-13", 13], ["2000-06-14", 78], ["2000-06-15", 245], ["2000-06-16", 139], ["2000-06-17", 115], ["2000-06-18", 111], ["2000-06-19", 309], ["2000-06-20", 206], ["2000-06-21", 137], ["2000-06-22", 128], ["2000-06-23", 85], ["2000-06-24", 94], ["2000-06-25", 71], ["2000-06-26", 106], ["2000-06-27", 84], ["2000-06-28", 93], ["2000-06-29", 85], ["2000-06-30", 73], ["2000-07-01", 83], ["2000-07-02", 125], ["2000-07-03", 107], ["2000-07-04", 82], ["2000-07-05", 44], ["2000-07-06", 72], ["2000-07-07", 106], ["2000-07-08", 107], ["2000-07-09", 66], ["2000-07-10", 91], ["2000-07-11", 92], ["2000-07-12", 113], ["2000-07-13", 107], ["2000-07-14", 131], ["2000-07-15", 111], ["2000-07-16", 64], ["2000-07-17", 69], ["2000-07-18", 88], ["2000-07-19", 77], ["2000-07-20", 83], ["2000-07-21", 111], ["2000-07-22", 57], ["2000-07-23", 55], ["2000-07-24", 60]];
                var dateList = alarmReceiptIndexList.map(function (item) {
                    return item.date;
                });
                var valueList1 = alarmReceiptIndexList.map(function (item) {
                    return item.count;
                });
                var valueList2 = caseIndexList.map(function (item) {
                    return item.count;
                });
                var valueList3 = caseSolveIndexList.map(function (item) {
                    return item.count;
                });
                option3 = {
                    // Make gradient line here
                    /*visualMap: [
                        {
                            show: true,
                            type: 'continuous',
                            seriesIndex: [0,1],
                            min: 0,
                            max: 400
                        }
                    ],*/
                    title: [
                        {
                            left: 'top',
                            text: '发/立/破案趋势图'
                        }
                    ],
                    legend: {
                        data: ['发案', '立案', '破案']
                    },
                    tooltip: {
                        trigger: 'axis'
                    },
                    xAxis: [
                        {
                            data: dateList,
                            gridIndex: 1
                        }
                    ],
                    yAxis: [
                        {
                            gridIndex: 1
                        }
                    ],
                    grid: [
                        {
                            bottom: '30%'
                        },
                        {
                            //top: '60%'
                        }
                    ],
                    series: [
                        {
                            type: 'line',
                            name: '发案',
                            showSymbol: false,
                            label: {
                                show: true,
                                position: 'top'
                            },
                            data: valueList1,
                            xAxisIndex: 0,
                            yAxisIndex: 0
                        },
                        {
                            type: 'line',
                            name: '立案',
                            showSymbol: false,
                            label: {
                                show: true,
                                position: 'top'
                            },
                            data: valueList2,
                            xAxisIndex: 0,
                            yAxisIndex: 0
                        },
                        {
                            type: 'line',
                            name: '破案',
                            showSymbol: false,
                            label: {
                                show: true,
                                position: 'top'
                            },
                            data: valueList3,
                            xAxisIndex: 0,
                            yAxisIndex: 0
                        }
                    ]
                };
                if (option3 && typeof option3 === 'object') {
                    console.log("myChart3.setOption(option3)")
                    myChart3.setOption(option3);
                }
            });

            $.get(ROOT_PATH + "/graph/getAlarmReceiptTypeIndex?dateStart="+dateStart+"&dateEnd="+dateEnd, function (data) {
                option4 = {
                    title: {
                        text: '发案类型',
                        subtext: dateStart+'至'+dateEnd,
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left'
                    },
                    series: [
                        {
                            name: '发案类型',
                            type: 'pie',
                            radius: '50%',
                            data: data,
                            label: {
                                show: true,
                                //position: 'inside', // 设置标签位置为饼图内部
                                formatter: '{b}: {c}'  // 设置标签内容为name和value
                            },
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                if (option4 && typeof option4 === 'object') {
                    console.log("myChart4.setOption(option4)")
                    myChart4.setOption(option4);
                }
            });

            $.get(ROOT_PATH + "/graph/getAlarmReceiptCommunityIndex?dateStart="+dateStart+"&dateEnd="+dateEnd, function (data) {
                option5 = {
                    title: {
                        text: '发案社区（前十）',
                        subtext: dateStart+'至'+dateEnd,
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'item'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left'
                    },
                    series: [
                        {
                            name: '发案社区',
                            type: 'pie',
                            radius: '50%',
                            data: data,
                            label: {
                                show: true,
                                //position: 'inside', // 设置标签位置为饼图内部
                                formatter: '{b}: {c}'  // 设置标签内容为name和value
                            },
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                if (option5 && typeof option5 === 'object') {
                    console.log("myChart5.setOption(option5)")
                    myChart5.setOption(option5);
                }
            });
        });

        window.addEventListener('resize', myChart.resize);
        window.addEventListener('resize', myChart2.resize);
        window.addEventListener('resize', myChart3.resize);
        window.addEventListener('resize', myChart4.resize);

        $("#data").keydown(function (event) {
            if (event.keyCode == 13) {
                $('#search-btn').click();
            }
            //Export();
        });

        function Export() {
            var canvas = document.getElementsByTagName("canvas")
            if (canvas && canvas.length > 0) {
                // 创建标签
                var oA = document.createElement("a")
                // 设置下载名称
                oA.download = "Echarts图表" + ".png"
                // 设置地址以及文件类型
                oA.href = canvas[0].toDataURL("image/png")
                document.body.appendChild(oA)
                // 触发下载事件
                oA.click()
                // 移除元素
                oA.remove()
            }
        }
    </script>

</body>
</html>